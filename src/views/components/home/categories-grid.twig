{#
  Categories Grid Component
  Display product categories in a grid layout
#}

{% set section_title = block.settings.title|default('تسوق حسب القسم') %}
{% set section_subtitle = block.settings.subtitle %}
{% set categories_source = block.settings.categories_source|default('all') %}
{% set categories_limit = block.settings.categories_limit|default(8) %}
{% set grid_columns = block.settings.grid_columns|default('4') %}
{% set show_count = block.settings.show_products_count|default(true) %}

{# Get categories #}
{% if categories_source == 'featured' %}
  {% set categories = store.featured_categories|slice(0, categories_limit) %}
{% elseif categories_source == 'custom' and block.settings.category_ids %}
  {% set categories = salla.categories(block.settings.category_ids) %}
{% else %}
  {% set categories = store.categories|slice(0, categories_limit) %}
{% endif %}

{% if categories|length > 0 %}
<section class="categories-grid-section py-12 md:py-16 bg-white">
  <div class="container">
    
    {# Section Header #}
    <div class="section-header mb-8 md:mb-12 text-center">
      {% if section_subtitle %}
      <p class="section-subtitle text-primary text-sm md:text-base font-medium mb-2">
        {{ section_subtitle }}
      </p>
      {% endif %}
      
      <h2 class="section-title text-2xl md:text-4xl font-bold">
        {{ section_title }}
      </h2>
    </div>
    
    {# Categories Grid #}
    <div class="categories-grid grid grid-cols-2 md:grid-cols-{{ grid_columns }} gap-4 md:gap-6">
      
      {% for category in categories %}
      <a 
        href="{{ category.url }}" 
        class="category-card group block relative overflow-hidden rounded-lg bg-gray-100 hover:shadow-xl transition-all duration-300"
      >
        
        {# Category Image #}
        <div class="category-image relative aspect-square overflow-hidden">
          {% if category.image %}
          <img 
            src="{{ category.image }}" 
            alt="{{ category.name }}"
            class="w-full h-full object-cover transition-transform duration-300 group-hover:scale-110"
            loading="lazy"
          >
          {% else %}
          <div class="w-full h-full bg-gradient-to-br from-primary to-secondary opacity-20"></div>
          {% endif %}
          
          {# Overlay #}
          <div class="absolute inset-0 bg-gradient-to-t from-black via-transparent to-transparent opacity-60"></div>
        </div>
        
        {# Category Info #}
        <div class="category-info absolute bottom-0 inset-x-0 p-4 text-white">
          <h3 class="category-name text-base md:text-lg font-bold mb-1 group-hover:text-accent transition-colors">
            {{ category.name }}
          </h3>
          
          {% if show_count and category.products_count %}
          <p class="category-count text-xs md:text-sm opacity-90">
            {{ category.products_count }} منتج
          </p>
          {% endif %}
        </div>
        
        {# Hover Effect #}
        <div class="category-hover absolute inset-0 bg-primary opacity-0 group-hover:opacity-10 transition-opacity"></div>
        
      </a>
      {% endfor %}
      
    </div>
    
    {# View All Button #}
    {% if block.settings.show_view_all %}
    <div class="text-center mt-8 md:mt-12">
      <a 
        href="{{ link('categories') }}" 
        class="inline-flex items-center px-8 py-3 bg-gray-100 hover:bg-gray-200 text-gray-800 font-medium rounded-lg transition-colors"
      >
        عرض جميع الأقسام
        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
        </svg>
      </a>
    </div>
    {% endif %}
    
  </div>
</section>
{% endif %}
